{"is_source_file": true, "format": "Python", "description": "This is a comprehensive FastAPI backend source file implementing REST API endpoints for a social media platform, including user management, profiles, posts, analytics, and admin functionalities. It defines models, dependencies, and route handlers for authentication, CRUD operations, and platform summaries.", "external_files": ["fastapi", "pydantic", "dotenv", "sqlite3"], "external_methods": ["load_dotenv", "os.getenv", "os.getcwd", "sqlite3.connect", "sqlite3.Row", "datetime.utcnow", "datetime.now", "timedelta", "hashlib.sha256"], "published": ["app", "get_db", "health_check", "login", "logout", "me", "list_users", "create_user", "get_user_by_id", "update_user", "delete_user", "list_profiles", "create_profile", "get_profile", "update_profile", "delete_profile", "list_posts", "create_post", "get_post", "update_post", "delete_post", "analytics_summary", "admin_summary", "grant_admin", "revoke_admin"], "classes": [{"name": "PageMeta", "description": "Pagination metadata model with current page, page size, and total count."}, {"name": "PaginatedResponse", "description": "Model for paginated API responses, including metadata and list of items."}, {"name": "UserBase", "description": "Base model for user data with email and name."}, {"name": "UserCreate", "description": "Model for creating a new user, extends UserBase with password."}, {"name": "UserUpdate", "description": "Model for updating user info with optional fields."}, {"name": "UserOut", "description": "Output model for user details, including ID and creation date."}, {"name": "ProfileBase", "description": "Base profile model with bio, website, avatar URL."}, {"name": "ProfileCreate", "description": "Model for creating a profile; associates with user_id."}, {"name": "ProfileUpdate", "description": "Model for updating profile info."}, {"name": "ProfileOut", "description": "Output model for profile data."}, {"name": "PostBase", "description": "Base model for posts with content and user association."}, {"name": "PostCreate", "description": "Model for creating a post."}, {"name": "PostUpdate", "description": "Model for updating post content."}, {"name": "PostOut", "description": "Output model for post details, including engagement metrics."}, {"name": "LoginRequest", "description": "Model for login credentials."}, {"name": "LoginResponse", "description": "Response model after login, containing user details and session ID."}, {"name": "AnalyticsSummary", "description": "Model summarizing platform analytics metrics."}, {"name": "AdminUserOut", "description": "Extended user info for admin views, including admin status."}], "methods": [{"name": "datetime _now_utc()", "description": "Returns current UTC datetime.", "scope": "", "scopeKind": ""}, {"name": "None _prune_sessions()", "description": "Removes expired sessions from in-memory store.", "scope": "", "scopeKind": ""}, {"name": "str _new_session(user_id: int)", "description": "Creates a new session for a given user ID.", "scope": "", "scopeKind": ""}, {"name": "Optional[Dict[str,Any]] _get_session(session_id: Optional[str])", "description": "Retrieves and updates a session if valid.", "scope": "", "scopeKind": ""}, {"name": "sqlite3.Connection get_db()", "description": "Provides a SQLite database connection with foreign key support.", "scope": "", "scopeKind": ""}, {"name": "str _hash_password(pw: str)", "description": "Hashes a password using SHA-256 (simple demo).", "scope": "", "scopeKind": ""}, {"name": "PaginatedResponse _paginate(q: str, params: tuple, page: int, page_size: int, conn: sqlite3.Connection)", "description": "Handles pagination logic for queries.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] get_current_session(session_id: Optional[str] = Cookie(default=None, alias=SESSION_COOKIE_NAME))", "description": "Dependency to fetch current user session from cookie.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] get_current_user(conn: sqlite3.Connection = Depends(get_db), sess: Dict[str, Any] = Depends(get_current_session))", "description": "Fetches current user info from session and database.", "scope": "", "scopeKind": ""}, {"name": "Dict[str,Any] require_admin(user: Dict[str, Any] = Depends(get_current_user))", "description": "Ensures the current user has admin privileges.", "scope": "", "scopeKind": ""}, {"name": "admin_summary(conn: sqlite3.Connection = Depends(get_db), _admin: Dict[str, Any] = Depends(require_admin))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "analytics_summary(conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] = Depends(get_current_user))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "create_post(payload: PostCreate, conn: sqlite3.Connection = Depends(get_db), current: Dict[str, Any] = Depends(get_current_user))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "create_profile(payload: ProfileCreate, conn: sqlite3.Connection = Depends(get_db), current: Dict[str, Any] = Depends(get_current_user))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "create_user(payload: UserCreate, conn: sqlite3.Connection = Depends(get_db), _admin: Dict[str, Any] = Depends(require_admin))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "delete_post(post_id: int, conn: sqlite3.Connection = Depends(get_db), current: Dict[str, Any] = Depends(get_current_user))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "delete_profile(profile_id: int, conn: sqlite3.Connection = Depends(get_db), current: Dict[str, Any] = Depends(get_current_user))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "delete_user(user_id: int, conn: sqlite3.Connection = Depends(get_db), _admin: Dict[str, Any] = Depends(require_admin))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "get_post(post_id: int, conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] = Depends(get_current_user))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "get_profile(profile_id: int, conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] = Depends(get_current_user))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "get_user_by_id(user_id: int, conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] = Depends(get_current_user))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "grant_admin(user_id: int, conn: sqlite3.Connection = Depends(get_db), _admin: Dict[str, Any] = Depends(require_admin))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "health_check()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "list_posts( page: int = Query(1, ge=1), page_size: int = Query(10, ge=1, le=100), user_id: Optional[int] = Query(None, description=\"Filter by author user id\"), conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] = Depends(get_current_user), )", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "list_profiles( page: int = Query(1, ge=1), page_size: int = Query(10, ge=1, le=100), user_id: Optional[int] = Query(None, description=\"Filter by user id\"), conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] = Depends(get_current_user), )", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "list_users( page: int = Query(1, ge=1, description=\"Page number\"), page_size: int = Query(10, ge=1, le=100, description=\"Items per page\"), q: Optional[str] = Query(None, description=\"Search query for email or name\"), conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] = Depends(get_current_user), )", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "login(payload: LoginRequest, response: Response, conn: sqlite3.Connection = Depends(get_db))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "logout(response: Response, session_id: Optional[str] = Cookie(default=None, alias=SESSION_COOKIE_NAME))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "me(user: Dict[str, Any] = Depends(get_current_user))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "revoke_admin(user_id: int, conn: sqlite3.Connection = Depends(get_db), _admin: Dict[str, Any] = Depends(require_admin))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "update_post(post_id: int, payload: PostUpdate, conn: sqlite3.Connection = Depends(get_db), current: Dict[str, Any] = Depends(get_current_user))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "update_profile(profile_id: int, payload: ProfileUpdate, conn: sqlite3.Connection = Depends(get_db), current: Dict[str, Any] = Depends(get_current_user))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "update_user(user_id: int, payload: UserUpdate, conn: sqlite3.Connection = Depends(get_db), current: Dict[str, Any] = Depends(get_current_user))", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["load_dotenv", "os.getenv", "sqlite3.connect", "conn.execute", "conn.execute", "conn.execute", "conn.execute", "conn.execute", "conn.execute", "conn.execute", "conn.execute", "conn.execute", "conn.execute", "conn.execute", "conn.execute", "conn.execute", "conn.execute", "conn.execute"], "search-terms": ["FastAPI social media backend", "auth login session", "user management endpoints", "profile CRUD", "post CRUD", "analytics summary", "admin privileges", "sqlite3 database", "pagination", "session cookies", "platform metrics"], "state": 2, "file_id": 3, "knowledge_revision": 14, "git_revision": "836c8cb052bbc5a47b54c25e2c3d0dbb3587f42a", "revision_history": [{"8": "836c8cb052bbc5a47b54c25e2c3d0dbb3587f42a"}, {"10": "836c8cb052bbc5a47b54c25e2c3d0dbb3587f42a"}, {"14": "836c8cb052bbc5a47b54c25e2c3d0dbb3587f42a"}], "ctags": [{"_type": "tag", "name": "AdminUserOut", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class AdminUserOut(UserOut):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "AnalyticsSummary", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class AnalyticsSummary(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "DEFAULT_DB_PATH", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^DEFAULT_DB_PATH = os.path.join(os.getcwd(), \"social_media.db\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "LoginRequest", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class LoginRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "LoginResponse", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class LoginResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PageMeta", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class PageMeta(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PaginatedResponse", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class PaginatedResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PostBase", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class PostBase(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PostCreate", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class PostCreate(PostBase):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PostOut", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class PostOut(PostBase):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "PostUpdate", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class PostUpdate(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ProfileBase", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class ProfileBase(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ProfileCreate", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class ProfileCreate(ProfileBase):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ProfileOut", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class ProfileOut(ProfileBase):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "ProfileUpdate", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class ProfileUpdate(ProfileBase):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "SESSION_COOKIE_NAME", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^SESSION_COOKIE_NAME = \"session_id\"$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "SESSION_TTL_MINUTES", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^SESSION_TTL_MINUTES = int(os.getenv(\"SESSION_TTL_MINUTES\", \"120\"))$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "SQLITE_DB", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^SQLITE_DB = os.getenv(\"SQLITE_DB\", DEFAULT_DB_PATH)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "UserBase", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class UserBase(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "UserCreate", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class UserCreate(UserBase):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "UserOut", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class UserOut(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "UserUpdate", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^class UserUpdate(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_SESSIONS", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^_SESSIONS: Dict[str, Dict[str, Any]] = {}$/", "language": "Python", "typeref": "typename:Dict[str, Dict[str, Any]]", "kind": "variable"}, {"_type": "tag", "name": "_get_session", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def _get_session(session_id: Optional[str]) -> Optional[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:Optional[Dict[str,Any]]", "kind": "function", "signature": "(session_id: Optional[str])"}, {"_type": "tag", "name": "_hash_password", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def _hash_password(pw: str) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(pw: str)"}, {"_type": "tag", "name": "_new_session", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def _new_session(user_id: int) -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "(user_id: int)"}, {"_type": "tag", "name": "_now_utc", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def _now_utc() -> datetime:$/", "language": "Python", "typeref": "typename:datetime", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_paginate", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def _paginate(q: str, params: tuple, page: int, page_size: int, conn: sqlite3.Connection) -> Pag/", "language": "Python", "typeref": "typename:PaginatedResponse", "kind": "function", "signature": "(q: str, params: tuple, page: int, page_size: int, conn: sqlite3.Connection)"}, {"_type": "tag", "name": "_prune_sessions", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def _prune_sessions() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "admin_router", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^admin_router = APIRouter(prefix=\"\\/admin\", tags=[\"admin\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "admin_summary", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def admin_summary(conn: sqlite3.Connection = Depends(get_db), _admin: Dict[str, Any] = Depends(r/", "language": "Python", "kind": "function", "signature": "(conn: sqlite3.Connection = Depends(get_db), _admin: Dict[str, Any] = Depends(require_admin))"}, {"_type": "tag", "name": "analytics_router", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^analytics_router = APIRouter(prefix=\"\\/analytics\", tags=[\"analytics\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "analytics_summary", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def analytics_summary(conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] = Depends(g/", "language": "Python", "kind": "function", "signature": "(conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] = Depends(get_current_user))"}, {"_type": "tag", "name": "app", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "auth_router", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^auth_router = APIRouter(prefix=\"\\/auth\", tags=[\"auth\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "avatar_url", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    avatar_url: Optional[constr(max_length=255)] = Field(None, description=\"Avatar URL\")$/", "language": "Python", "typeref": "typename:Optional[constr(max_length=255)]", "kind": "variable", "scope": "ProfileBase", "scopeKind": "class"}, {"_type": "tag", "name": "bio", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    bio: Optional[constr(max_length=280)] = Field(None, description=\"Short biography\")$/", "language": "Python", "typeref": "typename:Optional[constr(max_length=280)]", "kind": "variable", "scope": "ProfileBase", "scopeKind": "class"}, {"_type": "tag", "name": "comments", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    comments: int = 0$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "PostOut", "scopeKind": "class"}, {"_type": "tag", "name": "content", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    content: Optional[constr(min_length=1, max_length=500)] = Field(None, description=\"Updated c/", "language": "Python", "typeref": "typename:Optional[constr(min_length=1, max_length=500)]", "kind": "variable", "scope": "PostUpdate", "scopeKind": "class"}, {"_type": "tag", "name": "content", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    content: constr(min_length=1, max_length=500) = Field(..., description=\"Post text content\")$/", "language": "Python", "typeref": "typename:constr(min_length=1, max_length=500)", "kind": "variable", "scope": "PostBase", "scopeKind": "class"}, {"_type": "tag", "name": "create_post", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def create_post(payload: PostCreate, conn: sqlite3.Connection = Depends(get_db), current: Dict[s/", "language": "Python", "kind": "function", "signature": "(payload: PostCreate, conn: sqlite3.Connection = Depends(get_db), current: Dict[str, Any] = Depends(get_current_user))"}, {"_type": "tag", "name": "create_profile", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def create_profile(payload: ProfileCreate, conn: sqlite3.Connection = Depends(get_db), current: /", "language": "Python", "kind": "function", "signature": "(payload: ProfileCreate, conn: sqlite3.Connection = Depends(get_db), current: Dict[str, Any] = Depends(get_current_user))"}, {"_type": "tag", "name": "create_user", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def create_user(payload: UserCreate, conn: sqlite3.Connection = Depends(get_db), _admin: Dict[st/", "language": "Python", "kind": "function", "signature": "(payload: UserCreate, conn: sqlite3.Connection = Depends(get_db), _admin: Dict[str, Any] = Depends(require_admin))"}, {"_type": "tag", "name": "created_at", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    created_at: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "PostOut", "scopeKind": "class"}, {"_type": "tag", "name": "created_at", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    created_at: Optional[str] = None$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "UserOut", "scopeKind": "class"}, {"_type": "tag", "name": "delete_post", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def delete_post(post_id: int, conn: sqlite3.Connection = Depends(get_db), current: Dict[str, Any/", "language": "Python", "kind": "function", "signature": "(post_id: int, conn: sqlite3.Connection = Depends(get_db), current: Dict[str, Any] = Depends(get_current_user))"}, {"_type": "tag", "name": "delete_profile", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def delete_profile(profile_id: int, conn: sqlite3.Connection = Depends(get_db), current: Dict[st/", "language": "Python", "kind": "function", "signature": "(profile_id: int, conn: sqlite3.Connection = Depends(get_db), current: Dict[str, Any] = Depends(get_current_user))"}, {"_type": "tag", "name": "delete_user", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def delete_user(user_id: int, conn: sqlite3.Connection = Depends(get_db), _admin: Dict[str, Any]/", "language": "Python", "kind": "function", "signature": "(user_id: int, conn: sqlite3.Connection = Depends(get_db), _admin: Dict[str, Any] = Depends(require_admin))"}, {"_type": "tag", "name": "email", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    email: EmailStr = Field(..., description=\"Unique email address for the user\")$/", "language": "Python", "typeref": "typename:EmailStr", "kind": "variable", "scope": "UserBase", "scopeKind": "class"}, {"_type": "tag", "name": "email", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    email: EmailStr = Field(..., description=\"User email\")$/", "language": "Python", "typeref": "typename:EmailStr", "kind": "variable", "scope": "LoginRequest", "scopeKind": "class"}, {"_type": "tag", "name": "email", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    email: Optional[EmailStr] = Field(None, description=\"Updated email\")$/", "language": "Python", "typeref": "typename:Optional[EmailStr]", "kind": "variable", "scope": "UserUpdate", "scopeKind": "class"}, {"_type": "tag", "name": "get_current_session", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def get_current_session(session_id: Optional[str] = Cookie(default=None, alias=SESSION_COOKIE_NA/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(session_id: Optional[str] = Cookie(default=None, alias=SESSION_COOKIE_NAME))"}, {"_type": "tag", "name": "get_current_user", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def get_current_user(conn: sqlite3.Connection = Depends(get_db), sess: Dict[str, Any] = Depends(/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(conn: sqlite3.Connection = Depends(get_db), sess: Dict[str, Any] = Depends(get_current_session))"}, {"_type": "tag", "name": "get_db", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def get_db() -> sqlite3.Connection:$/", "language": "Python", "typeref": "typename:sqlite3.Connection", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_post", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def get_post(post_id: int, conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] = Depe/", "language": "Python", "kind": "function", "signature": "(post_id: int, conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] = Depends(get_current_user))"}, {"_type": "tag", "name": "get_profile", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def get_profile(profile_id: int, conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] /", "language": "Python", "kind": "function", "signature": "(profile_id: int, conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] = Depends(get_current_user))"}, {"_type": "tag", "name": "get_user_by_id", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def get_user_by_id(user_id: int, conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] /", "language": "Python", "kind": "function", "signature": "(user_id: int, conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] = Depends(get_current_user))"}, {"_type": "tag", "name": "grant_admin", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def grant_admin(user_id: int, conn: sqlite3.Connection = Depends(get_db), _admin: Dict[str, Any]/", "language": "Python", "kind": "function", "signature": "(user_id: int, conn: sqlite3.Connection = Depends(get_db), _admin: Dict[str, Any] = Depends(require_admin))"}, {"_type": "tag", "name": "health_check", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def health_check():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "health_router", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^health_router = APIRouter()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "is_admin", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    is_admin: bool = False$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "AdminUserOut", "scopeKind": "class"}, {"_type": "tag", "name": "likes", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    likes: int = 0$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "PostOut", "scopeKind": "class"}, {"_type": "tag", "name": "list_posts", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def list_posts($/", "language": "Python", "kind": "function", "signature": "( page: int = Query(1, ge=1), page_size: int = Query(10, ge=1, le=100), user_id: Optional[int] = Query(None, description=\"Filter by author user id\"), conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] = Depends(get_current_user), )"}, {"_type": "tag", "name": "list_profiles", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def list_profiles($/", "language": "Python", "kind": "function", "signature": "( page: int = Query(1, ge=1), page_size: int = Query(10, ge=1, le=100), user_id: Optional[int] = Query(None, description=\"Filter by user id\"), conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] = Depends(get_current_user), )"}, {"_type": "tag", "name": "list_users", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def list_users($/", "language": "Python", "kind": "function", "signature": "( page: int = Query(1, ge=1, description=\"Page number\"), page_size: int = Query(10, ge=1, le=100, description=\"Items per page\"), q: Optional[str] = Query(None, description=\"Search query for email or name\"), conn: sqlite3.Connection = Depends(get_db), _u: Dict[str, Any] = Depends(get_current_user), )"}, {"_type": "tag", "name": "login", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def login(payload: LoginRequest, response: Response, conn: sqlite3.Connection = Depends(get_db))/", "language": "Python", "kind": "function", "signature": "(payload: LoginRequest, response: Response, conn: sqlite3.Connection = Depends(get_db))"}, {"_type": "tag", "name": "logout", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def logout(response: Response, session_id: Optional[str] = Cookie(default=None, alias=SESSION_CO/", "language": "Python", "kind": "function", "signature": "(response: Response, session_id: Optional[str] = Cookie(default=None, alias=SESSION_COOKIE_NAME))"}, {"_type": "tag", "name": "me", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def me(user: Dict[str, Any] = Depends(get_current_user)):$/", "language": "Python", "kind": "function", "signature": "(user: Dict[str, Any] = Depends(get_current_user))"}, {"_type": "tag", "name": "name", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    name: Optional[constr(min_length=1, max_length=100)] = Field(None, description=\"Updated name/", "language": "Python", "typeref": "typename:Optional[constr(min_length=1, max_length=100)]", "kind": "variable", "scope": "UserUpdate", "scopeKind": "class"}, {"_type": "tag", "name": "name", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    name: constr(min_length=1, max_length=100) = Field(..., description=\"Display name\")$/", "language": "Python", "typeref": "typename:constr(min_length=1, max_length=100)", "kind": "variable", "scope": "UserBase", "scopeKind": "class"}, {"_type": "tag", "name": "page", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    page: int = Field(..., description=\"Current page number (1-indexed)\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "PageMeta", "scopeKind": "class"}, {"_type": "tag", "name": "page_size", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    page_size: int = Field(..., description=\"Number of items per page\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "PageMeta", "scopeKind": "class"}, {"_type": "tag", "name": "password", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    password: Optional[constr(min_length=6, max_length=128)] = Field(None, description=\"Updated /", "language": "Python", "typeref": "typename:Optional[constr(min_length=6, max_length=128)]", "kind": "variable", "scope": "UserUpdate", "scopeKind": "class"}, {"_type": "tag", "name": "password", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    password: constr(min_length=6, max_length=128) = Field(..., description=\"Plain password to b/", "language": "Python", "typeref": "typename:constr(min_length=6, max_length=128)", "kind": "variable", "scope": "UserCreate", "scopeKind": "class"}, {"_type": "tag", "name": "password", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    password: str = Field(..., description=\"User password\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "LoginRequest", "scopeKind": "class"}, {"_type": "tag", "name": "posts_router", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^posts_router = APIRouter(prefix=\"\\/posts\", tags=[\"posts\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "profiles_router", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^profiles_router = APIRouter(prefix=\"\\/profiles\", tags=[\"profiles\"])$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "require_admin", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def require_admin(user: Dict[str, Any] = Depends(get_current_user)) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(user: Dict[str, Any] = Depends(get_current_user))"}, {"_type": "tag", "name": "revoke_admin", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def revoke_admin(user_id: int, conn: sqlite3.Connection = Depends(get_db), _admin: Dict[str, Any/", "language": "Python", "kind": "function", "signature": "(user_id: int, conn: sqlite3.Connection = Depends(get_db), _admin: Dict[str, Any] = Depends(require_admin))"}, {"_type": "tag", "name": "shares", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    shares: int = 0$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "PostOut", "scopeKind": "class"}, {"_type": "tag", "name": "total", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    total: int = Field(..., description=\"Total number of records available\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "PageMeta", "scopeKind": "class"}, {"_type": "tag", "name": "update_post", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def update_post(post_id: int, payload: PostUpdate, conn: sqlite3.Connection = Depends(get_db), c/", "language": "Python", "kind": "function", "signature": "(post_id: int, payload: PostUpdate, conn: sqlite3.Connection = Depends(get_db), current: Dict[str, Any] = Depends(get_current_user))"}, {"_type": "tag", "name": "update_profile", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def update_profile(profile_id: int, payload: ProfileUpdate, conn: sqlite3.Connection = Depends(g/", "language": "Python", "kind": "function", "signature": "(profile_id: int, payload: ProfileUpdate, conn: sqlite3.Connection = Depends(get_db), current: Dict[str, Any] = Depends(get_current_user))"}, {"_type": "tag", "name": "update_user", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^def update_user(user_id: int, payload: UserUpdate, conn: sqlite3.Connection = Depends(get_db), c/", "language": "Python", "kind": "function", "signature": "(user_id: int, payload: UserUpdate, conn: sqlite3.Connection = Depends(get_db), current: Dict[str, Any] = Depends(get_current_user))"}, {"_type": "tag", "name": "user_id", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    user_id: int = Field(..., description=\"Associated user id\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "ProfileCreate", "scopeKind": "class"}, {"_type": "tag", "name": "user_id", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^    user_id: int = Field(..., description=\"Author user id\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "PostBase", "scopeKind": "class"}, {"_type": "tag", "name": "users_router", "path": "/tmp/kavia/workspace/code-generation/user-approval-system-747-756/social_media_backend/src/api/main.py", "pattern": "/^users_router = APIRouter(prefix=\"\\/users\", tags=[\"users\"])$/", "language": "Python", "kind": "variable"}], "hash": "1fb6966e736d68267b4d11bd6fa6f64f", "format-version": 4, "code-base-name": "social_media_backend", "filename": "social_media_backend/src/api/main.py", "fields": [{"name": "DEFAULT_DB_PATH = os.path.join(os.getcwd(), \"social_media.db\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SESSION_COOKIE_NAME = \"session_id\"", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SESSION_TTL_MINUTES = int(os.getenv(\"SESSION_TTL_MINUTES\", \"120\"))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "SQLITE_DB = os.getenv(\"SQLITE_DB\", DEFAULT_DB_PATH)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str, Dict[str, Any]] _SESSIONS", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "admin_router = APIRouter(prefix=\"\\/admin\", tags=[\"admin\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "analytics_router = APIRouter(prefix=\"\\/analytics\", tags=[\"analytics\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "auth_router = APIRouter(prefix=\"\\/auth\", tags=[\"auth\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Optional[constr(max_length=255)] avatar_url", "scope": "ProfileBase", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[constr(max_length=280)] bio", "scope": "ProfileBase", "scopeKind": "class", "description": "unavailable"}, {"name": "int comments", "scope": "PostOut", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[constr(min_length=1, max_length=500)] content", "scope": "PostUpdate", "scopeKind": "class", "description": "unavailable"}, {"name": "constr(min_length=1, max_length=500) content", "scope": "PostBase", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] created_at", "scope": "PostOut", "scopeKind": "class", "description": "unavailable"}, {"name": "EmailStr email", "scope": "UserBase", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[EmailStr] email", "scope": "UserUpdate", "scopeKind": "class", "description": "unavailable"}, {"name": "health_router = APIRouter()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "bool is_admin", "scope": "AdminUserOut", "scopeKind": "class", "description": "unavailable"}, {"name": "int likes", "scope": "PostOut", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[constr(min_length=1, max_length=100)] name", "scope": "UserUpdate", "scopeKind": "class", "description": "unavailable"}, {"name": "constr(min_length=1, max_length=100) name", "scope": "UserBase", "scopeKind": "class", "description": "unavailable"}, {"name": "int page", "scope": "PageMeta", "scopeKind": "class", "description": "unavailable"}, {"name": "int page_size", "scope": "PageMeta", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[constr(min_length=6, max_length=128)] password", "scope": "UserUpdate", "scopeKind": "class", "description": "unavailable"}, {"name": "constr(min_length=6, max_length=128) password", "scope": "UserCreate", "scopeKind": "class", "description": "unavailable"}, {"name": "str password", "scope": "LoginRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "posts_router = APIRouter(prefix=\"\\/posts\", tags=[\"posts\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "profiles_router = APIRouter(prefix=\"\\/profiles\", tags=[\"profiles\"])", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "int shares", "scope": "PostOut", "scopeKind": "class", "description": "unavailable"}, {"name": "int total", "scope": "PageMeta", "scopeKind": "class", "description": "unavailable"}, {"name": "int user_id", "scope": "ProfileCreate", "scopeKind": "class", "description": "unavailable"}, {"name": "users_router = APIRouter(prefix=\"\\/users\", tags=[\"users\"])", "scope": "", "scopeKind": "", "description": "unavailable"}]}